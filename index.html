<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fantasy Golf League - Live Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <style>
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    .drag-over { border-color: #2563eb; background-color: #eff6ff; }
    @keyframes pulse-green { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .pulse-green { animation: pulse-green 2s ease-in-out infinite; }
  </style>
</head>
<body class="bg-white text-gray-900">
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <script>
  const { useEffect, useMemo, useState, useCallback } = React;

  // Helper functions
  function currency(n) {
    if (n === null || n === undefined) return 'â€”';
    if (n === 0) return '$0';
    try {
      return n.toLocaleString('en-US', { style: "currency", currency: "USD", maximumFractionDigits: 0 });
    } catch (e) {
      return '$' + n.toFixed(0);
    }
  }

  function clsx() {
    return Array.from(arguments).filter(Boolean).join(" ");
  }

  // Parse Excel file
  function parseExcelFile(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array', cellDates: true });
          
          const historicalSheet = workbook.Sheets['Historical_Data'];
          const historicalData = XLSX.utils.sheet_to_json(historicalSheet, { defval: null, raw: false });
          
          const tournamentSheet = workbook.Sheets['Tournament Info'];
          const tournamentData = XLSX.utils.sheet_to_json(tournamentSheet, { defval: null, raw: false, cellDates: true });
          
          resolve({
            historical: historicalData.filter(row => row.Player && row.Tournament && row.Pick),
            tournaments: tournamentData.filter(row => row['Tournament Name'])
          });
        } catch (error) {
          reject(error);
        }
      };
      reader.onerror = reject;
      reader.readAsArrayBuffer(file);
    });
  }

  // Scrape ESPN leaderboard using CORS proxy
  async function scrapeESPNLeaderboard() {
    try {
      // Use a CORS proxy to fetch the ESPN page
      const corsProxy = 'https://api.allorigins.win/raw?url=';
      const espnUrl = encodeURIComponent('https://www.espn.com/golf/leaderboard');
      
      const response = await fetch(corsProxy + espnUrl);
      if (!response.ok) throw new Error('Failed to fetch leaderboard');
      
      const html = await response.text();
      
      // Create a temporary DOM parser
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      // Extract tournament name
      const titleElement = doc.querySelector('.Leaderboard__Event__Title, h1');
      const tournamentName = titleElement ? titleElement.textContent.trim() : 'Unknown Tournament';
      
      // Extract status
      const statusElement = doc.querySelector('.Leaderboard__Event__Date, .Leaderboard__Round__Info');
      const status = statusElement ? statusElement.textContent.trim() : 'In Progress';
      
      // Extract leaderboard data from table rows
      const leaderboard = [];
      const rows = doc.querySelectorAll('.Table__TR.Table__TR--sm, tr.Table__TR');
      
      rows.forEach(row => {
        try {
          // Skip header rows
          if (row.querySelector('th')) return;
          
          const cells = row.querySelectorAll('td');
          if (cells.length < 3) return;
          
          // Get all cell text first for debugging
          const cellTexts = Array.from(cells).map(c => c.textContent.trim());
          
          // Find the name cell - it should contain a link or be the second cell
          let name = '';
          let nameIndex = -1;
          
          for (let i = 0; i < Math.min(cells.length, 3); i++) {
            const cell = cells[i];
            const link = cell.querySelector('a, .AnchorLink');
            if (link && link.textContent.trim().length > 3) {
              name = link.textContent.trim();
              nameIndex = i;
              break;
            }
          }
          
          // If no link found, try cell 1 (typical name position)
          if (!name && cells[1]) {
            name = cells[1].textContent.trim();
            nameIndex = 1;
          }
          
          // Clean up name (remove extra whitespace)
          name = name.replace(/\s+/g, ' ').trim();
          
          if (!name || name === '' || name.length < 3) return;
          
          // Position is typically the cell before the name
          let position = 'â€”';
          if (nameIndex > 0) {
            position = cells[nameIndex - 1].textContent.trim();
          } else if (cells[0]) {
            position = cells[0].textContent.trim();
          }
          
          // Score to par - look for pattern like -3, +2, E in cells after name
          let score = 'â€”';
          for (let i = nameIndex + 1; i < cells.length; i++) {
            const cellText = cells[i].textContent.trim();
            // Score patterns: -3, +2, E, --
            if (cellText.match(/^[+\-]\d+$/) || cellText === 'E' || cellText === '--') {
              score = cellText === '--' ? 'E' : cellText;
              break;
            }
          }
          
          // Thru - look for pattern like F, 8*, 13, etc.
          let thru = 'â€”';
          for (let i = nameIndex + 1; i < cells.length; i++) {
            const cellText = cells[i].textContent.trim();
            // Thru patterns: F (finished), 8* (started on 10), 13 (through 13)
            if (cellText === 'F' || cellText.match(/^\d{1,2}\*?$/)) {
              // Skip if this looks like a score (round score like 59, 65, etc)
              const num = parseInt(cellText);
              if (!isNaN(num) && num > 50 && num < 90 && !cellText.includes('*')) {
                continue; // This is likely a round score, not thru
              }
              thru = cellText;
              break;
            }
          }
          
          // Earnings - look for currency values
          let earnings = 0;
          for (let i = nameIndex + 1; i < cells.length; i++) {
            const cellText = cells[i].textContent.trim();
            if (cellText.match(/^\$[\d,]+$/)) {
              earnings = parseFloat(cellText.replace(/[$,]/g, ''));
              break;
            }
          }
          
          leaderboard.push({
            name,
            position,
            score,
            thru,
            earnings
          });
        } catch (e) {
          console.warn('Error parsing row:', e);
        }
      });
      
      // If we didn't get data from table, try alternative selectors
      if (leaderboard.length === 0) {
        // Try alternate structure
        const playerElements = doc.querySelectorAll('[data-player-uid], .player-row, .leaderboard-player');
        
        playerElements.forEach(elem => {
          try {
            const name = elem.querySelector('.player-name, .name, a')?.textContent.trim();
            const position = elem.querySelector('.position, .rank')?.textContent.trim();
            const score = elem.querySelector('.score, .total')?.textContent.trim();
            
            if (name) {
              leaderboard.push({
                name,
                position: position || 'â€”',
                score: score || 'â€”',
                thru: 'â€”',
                earnings: 0
              });
            }
          } catch (e) {
            console.warn('Error parsing player element:', e);
          }
        });
      }
      
      return {
        tournamentName,
        status,
        leaderboard: leaderboard.filter(g => g.name && g.name.length > 2),
        lastUpdated: new Date(),
        rawDataAvailable: leaderboard.length > 0
      };
    } catch (error) {
      console.error('Error scraping ESPN leaderboard:', error);
      throw error;
    }
  }

  function getCurrentTournament(tournaments) {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    for (const t of tournaments) {
      const start = t['Tournament Start Date'] ? new Date(t['Tournament Start Date']) : null;
      const end = t['Tournament End Date'] ? new Date(t['Tournament End Date']) : null;
      
      if (start && end) {
        start.setHours(0, 0, 0, 0);
        end.setHours(23, 59, 59, 999);
        
        if (today >= start && today <= end) {
          return t;
        }
      }
    }
    
    const upcoming = tournaments
      .filter(t => t['Tournament Start Date'])
      .map(t => ({ ...t, startDate: new Date(t['Tournament Start Date']) }))
      .filter(t => t.startDate >= today)
      .sort((a, b) => a.startDate - b.startDate);
    
    return upcoming[0] || tournaments[0] || null;
  }

  function getUsedGolfers(historical) {
    const used = {};
    historical.forEach(h => {
      if (!used[h.Player]) used[h.Player] = [];
      if (h.Pick && !used[h.Player].includes(h.Pick)) {
        used[h.Player].push(h.Pick);
      }
    });
    return used;
  }

  // Fuzzy match golfer names
  function matchGolferName(pickName, golferName) {
    const normalize = (str) => str.toLowerCase().replace(/[^a-z]/g, '');
    const pick = normalize(pickName);
    const golfer = normalize(golferName);
    
    // Exact match
    if (pick === golfer) return true;
    
    // Contains match
    if (pick.includes(golfer) || golfer.includes(pick)) return true;
    
    // Split and check parts (handles "Last, First" vs "First Last")
    const pickParts = pick.split(' ').filter(p => p.length > 2);
    const golferParts = golfer.split(' ').filter(p => p.length > 2);
    
    // Check if both parts match in any order
    if (pickParts.length >= 2 && golferParts.length >= 2) {
      const allMatch = pickParts.every(part => golferParts.some(gp => gp.includes(part) || part.includes(gp)));
      if (allMatch) return true;
    }
    
    return false;
  }

  // Main App Component
  function App() {
    const [excelData, setExcelData] = useState(null);
    const [tab, setTab] = useState("upload");
    const [isDragging, setIsDragging] = useState(false);
    const [liveData, setLiveData] = useState(null);
    const [isLoadingLive, setIsLoadingLive] = useState(false);
    const [lastUpdate, setLastUpdate] = useState(null);
    const [error, setError] = useState(null);

    const members = ["Mike", "Gordo", "Kyle", "Craig", "Phil", "Todd", "Rahul", "Andrew", "Dan"];

    useEffect(() => {
      const saved = localStorage.getItem('fantasyGolfData');
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          setExcelData(parsed);
          setTab("week");
        } catch (e) {
          console.error('Failed to load saved data', e);
        }
      }
    }, []);

    useEffect(() => {
      if (excelData) {
        localStorage.setItem('fantasyGolfData', JSON.stringify(excelData));
      }
    }, [excelData]);

    // Auto-refresh live data every 3 minutes when on live tab
    useEffect(() => {
      if (tab === "live" && excelData) {
        fetchLiveData();
        const interval = setInterval(fetchLiveData, 180000); // 3 minutes
        return () => clearInterval(interval);
      }
    }, [tab, excelData]);

    const fetchLiveData = async () => {
      setIsLoadingLive(true);
      setError(null);
      try {
        const data = await scrapeESPNLeaderboard();
        if (data) {
          setLiveData(data);
          setLastUpdate(data.lastUpdated);
        }
      } catch (err) {
        setError('Failed to load ESPN leaderboard. Please try again.');
        console.error(err);
      }
      setIsLoadingLive(false);
    };

    const handleFileUpload = async (file) => {
      if (!file) return;
      try {
        const data = await parseExcelFile(file);
        setExcelData(data);
        setTab("week");
      } catch (error) {
        alert('Error parsing Excel file: ' + error.message);
      }
    };

    const handleDrop = useCallback((e) => {
      e.preventDefault();
      setIsDragging(false);
      const file = e.dataTransfer.files[0];
      if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xlsm'))) {
        handleFileUpload(file);
      } else {
        alert('Please upload an Excel file (.xlsx or .xlsm)');
      }
    }, []);

    const handleDragOver = useCallback((e) => {
      e.preventDefault();
      setIsDragging(true);
    }, []);

    const handleDragLeave = useCallback((e) => {
      e.preventDefault();
      setIsDragging(false);
    }, []);

    const currentTournament = useMemo(() => {
      if (!excelData) return null;
      return getCurrentTournament(excelData.tournaments);
    }, [excelData]);

    const usedGolfers = useMemo(() => {
      if (!excelData) return {};
      return getUsedGolfers(excelData.historical);
    }, [excelData]);

    // Calculate picks used by player (for Picks Used tab)
    const picksUsedByPlayer = useMemo(() => {
      if (!excelData) return {};
      const picksByPlayer = {};
      members.forEach(m => picksByPlayer[m] = []);
      
      excelData.historical.forEach(h => {
        if (picksByPlayer[h.Player] !== undefined && h.Pick) {
          // Check if already in list (avoid duplicates)
          if (!picksByPlayer[h.Player].includes(h.Pick)) {
            picksByPlayer[h.Player].push(h.Pick);
          }
        }
      });
      
      return picksByPlayer;
    }, [excelData]);

    const currentWeekPicks = useMemo(() => {
      if (!excelData || !currentTournament) return [];
      return excelData.historical.filter(h => h.Tournament === currentTournament['Tournament Name']);
    }, [excelData, currentTournament]);

    const seasonStandings = useMemo(() => {
      if (!excelData) return [];
      
      const totals = {};
      members.forEach(m => totals[m] = 0);
      
      excelData.historical.forEach(h => {
        if (totals[h.Player] !== undefined) {
          totals[h.Player] += (h.Results || 0);
        }
      });
      
      return Object.entries(totals)
        .map(([name, total]) => ({ name, total }))
        .sort((a, b) => b.total - a.total);
    }, [excelData]);

    const leaderName = seasonStandings[0]?.name || null;

    if (!excelData) {
      return (
        React.createElement("div", { className: "min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center p-4" },
          React.createElement("div", { className: "max-w-md w-full" },
            React.createElement("div", { className: "bg-white rounded-2xl shadow-xl p-8" },
              React.createElement("div", { className: "text-center mb-6" },
                React.createElement("div", { className: "text-4xl mb-3" }, "â›³"),
                React.createElement("h1", { className: "text-2xl font-bold text-blue-900 mb-2" }, "Fantasy Golf League"),
                React.createElement("p", { className: "text-gray-600 text-sm" }, "Upload your Excel backend to get started")
              ),
              React.createElement("div", {
                className: clsx(
                  "border-3 border-dashed rounded-xl p-12 text-center transition-all",
                  isDragging ? "drag-over border-blue-500" : "border-gray-300 hover:border-blue-400"
                ),
                onDrop: handleDrop,
                onDragOver: handleDragOver,
                onDragLeave: handleDragLeave
              },
                React.createElement("input", {
                  type: "file",
                  id: "fileInput",
                  accept: ".xlsx,.xlsm",
                  className: "hidden",
                  onChange: (e) => handleFileUpload(e.target.files[0])
                }),
                React.createElement("label", {
                  htmlFor: "fileInput",
                  className: "cursor-pointer"
                },
                  React.createElement("div", { className: "text-4xl mb-3" }, "ðŸ“Š"),
                  React.createElement("p", { className: "font-semibold text-gray-700 mb-2" }, "Drop Excel file here"),
                  React.createElement("p", { className: "text-sm text-gray-500" }, "or click to browse"),
                  React.createElement("p", { className: "text-xs text-gray-400 mt-3" }, "Accepts .xlsx or .xlsm files")
                )
              )
            )
          )
        )
      );
    }

    return (
      React.createElement("div", { className: "min-h-screen bg-white text-gray-900 flex flex-col" },
        React.createElement("header", { className: "bg-blue-900 text-white px-4 py-3 shadow-md" },
          React.createElement("div", { className: "max-w-md mx-auto flex items-center justify-between" },
            React.createElement("div", null,
              React.createElement("div", { className: "font-bold tracking-wide" }, "Fantasy Golf League"),
              currentTournament && React.createElement("div", { className: "text-xs opacity-80" }, currentTournament['Tournament Name'])
            ),
            React.createElement("button", {
              onClick: () => {
                if (confirm('Clear all data and upload a new file?')) {
                  localStorage.removeItem('fantasyGolfData');
                  setExcelData(null);
                  setTab("upload");
                }
              },
              className: "text-xs bg-blue-800 hover:bg-blue-700 px-3 py-1 rounded"
            }, "Upload New")
          )
        ),

        React.createElement("main", { className: "flex-1 max-w-md mx-auto w-full pb-24" },
          tab === "week" && React.createElement(ThisWeek, { 
            leaderName, 
            currentWeekPicks,
            currentTournament
          }),
          tab === "live" && React.createElement(LiveLeaderboard, {
            currentWeekPicks,
            liveData,
            isLoadingLive,
            lastUpdate,
            onRefresh: fetchLiveData,
            currentTournament,
            error,
            matchGolferName
          }),
          tab === "picks" && React.createElement(PicksUsed, {
            picksUsedByPlayer,
            members
          }),
          tab === "standings" && React.createElement(Standings, { 
            historical: excelData.historical,
            members,
            currentTournament
          }),
          tab === "history" && React.createElement(History, { 
            historical: excelData.historical 
          })
        ),

        React.createElement("nav", { className: "fixed bottom-0 inset-x-0 bg-blue-900 text-white" },
          React.createElement("div", { className: "max-w-md mx-auto grid grid-cols-5" },
            React.createElement(TabButton, { active: tab === "week", onClick: () => setTab("week"), label: "This Week" }),
            React.createElement(TabButton, { active: tab === "live", onClick: () => setTab("live"), label: "ðŸ”´ Live", isLive: true }),
            React.createElement(TabButton, { active: tab === "picks", onClick: () => setTab("picks"), label: "Picks Used" }),
            React.createElement(TabButton, { active: tab === "standings", onClick: () => setTab("standings"), label: "Standings" }),
            React.createElement(TabButton, { active: tab === "history", onClick: () => setTab("history"), label: "History" })
          )
        )
      )
    );
  }

  function TabButton({ active, onClick, label, isLive }) {
    return React.createElement("button", {
      onClick,
      className: clsx(
        "py-3 text-sm font-medium border-t-2 relative",
        active ? "bg-blue-800 border-yellow-400" : "bg-blue-900 border-transparent",
        "focus:outline-none w-full"
      )
    }, 
      label,
      isLive && !active && React.createElement("span", { 
        className: "absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full pulse-green"
      })
    );
  }

  function LiveLeaderboard({ currentWeekPicks, liveData, isLoadingLive, lastUpdate, onRefresh, currentTournament, error, matchGolferName }) {
    // Match picks to live leaderboard
    const matchedPicks = useMemo(() => {
      if (!liveData || !currentWeekPicks.length) return [];
      
      return currentWeekPicks.map(pick => {
        // Find matching golfer in live leaderboard
        const golferData = liveData.leaderboard.find(g => matchGolferName(pick.Pick, g.name));
        
        return {
          player: pick.Player,
          golfer: pick.Pick,
          position: golferData?.position || 'â€”',
          score: golferData?.score || 'â€”',
          thru: golferData?.thru || 'â€”',
          earnings: golferData?.earnings || 0,
          found: !!golferData
        };
      }).sort((a, b) => {
        // Sort by position first
        const posA = parseInt(a.position.replace(/[^\d]/g, '')) || 999;
        const posB = parseInt(b.position.replace(/[^\d]/g, '')) || 999;
        if (posA !== posB) return posA - posB;
        
        // Then by earnings
        return b.earnings - a.earnings;
      });
    }, [liveData, currentWeekPicks, matchGolferName]);

    const formatTime = (date) => {
      if (!date) return '';
      return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
    };

    if (error) {
      return (
        React.createElement("section", { className: "px-4 pt-4" },
          React.createElement("div", { className: "bg-red-50 border-2 border-red-200 rounded-xl p-8 text-center" },
            React.createElement("div", { className: "text-4xl mb-3" }, "âš ï¸"),
            React.createElement("h3", { className: "text-lg font-semibold text-red-900 mb-2" }, "Error Loading Leaderboard"),
            React.createElement("p", { className: "text-sm text-red-700 mb-4" }, error),
            React.createElement("button", {
              onClick: onRefresh,
              className: "bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold"
            }, "Try Again")
          ),
          React.createElement("div", { className: "mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4 text-xs" },
            React.createElement("p", { className: "font-semibold mb-2" }, "ðŸ’¡ Troubleshooting:"),
            React.createElement("ul", { className: "list-disc list-inside space-y-1 text-gray-700" },
              React.createElement("li", null, "CORS proxy may be temporarily down"),
              React.createElement("li", null, "ESPN website structure may have changed"),
              React.createElement("li", null, "Check your internet connection"),
              React.createElement("li", null, "Try again in a few minutes")
            )
          )
        )
      );
    }

    if (!liveData && !isLoadingLive) {
      return (
        React.createElement("section", { className: "px-4 pt-4" },
          React.createElement("div", { className: "bg-blue-50 border-2 border-blue-200 rounded-xl p-8 text-center" },
            React.createElement("div", { className: "text-4xl mb-3" }, "ðŸ“¡"),
            React.createElement("h3", { className: "text-lg font-semibold text-blue-900 mb-2" }, "Live Leaderboard"),
            React.createElement("p", { className: "text-sm text-gray-600 mb-4" }, "Tap the button below to load live scores from ESPN"),
            React.createElement("button", {
              onClick: onRefresh,
              className: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold"
            }, "Load Live Scores")
          ),
          React.createElement("div", { className: "mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-xs" },
            React.createElement("p", { className: "font-semibold text-yellow-900 mb-1" }, "â„¹ï¸ How it works:"),
            React.createElement("p", { className: "text-yellow-800" }, 
              "This app scrapes ESPN's public leaderboard webpage to get live tournament scores. ",
              "It uses a CORS proxy to access the data from your browser."
            )
          )
        )
      );
    }

    return (
      React.createElement("section", { className: "px-4 pt-4" },
        React.createElement("div", { className: "bg-gradient-to-r from-red-600 to-red-700 rounded-xl p-4 text-white mb-4" },
          React.createElement("div", { className: "flex items-center justify-between mb-2" },
            React.createElement("div", null,
              React.createElement("h2", { className: "text-xl font-bold" }, "ðŸ”´ Live Leaderboard"),
              liveData && React.createElement("p", { className: "text-sm opacity-90" }, liveData.tournamentName)
            ),
            React.createElement("button", {
              onClick: onRefresh,
              disabled: isLoadingLive,
              className: clsx(
                "bg-red-800 hover:bg-red-900 disabled:bg-red-900 px-3 py-1 rounded text-xs font-semibold",
                isLoadingLive && "opacity-50 cursor-not-allowed"
              )
            }, isLoadingLive ? "â³" : "â†» Refresh")
          ),
          liveData && React.createElement("div", { className: "text-xs opacity-80 flex items-center gap-2" },
            React.createElement("span", null, liveData.status),
            lastUpdate && React.createElement("span", null, "â€¢ Updated ", formatTime(lastUpdate))
          )
        ),

        isLoadingLive && React.createElement("div", { className: "text-center py-12" },
          React.createElement("div", { className: "text-5xl mb-3 animate-bounce" }, "â³"),
          React.createElement("p", { className: "text-gray-600 font-semibold" }, "Fetching ESPN data..."),
          React.createElement("p", { className: "text-gray-500 text-sm mt-2" }, "This may take a few seconds")
        ),

        !isLoadingLive && liveData && !liveData.rawDataAvailable && React.createElement("div", { className: "bg-yellow-50 border border-yellow-300 rounded-lg p-4 mb-4" },
          React.createElement("p", { className: "text-sm text-yellow-900 font-semibold mb-1" }, "âš ï¸ No leaderboard data found"),
          React.createElement("p", { className: "text-xs text-yellow-800" }, 
            "ESPN's page structure may have changed or no tournament is currently active. Try refreshing or check ESPN.com directly."
          )
        ),

        !isLoadingLive && matchedPicks.length > 0 && React.createElement("div", { className: "space-y-3 mb-16" },
          matchedPicks.map((pick, idx) => 
            React.createElement("div", {
              key: idx,
              className: clsx(
                "bg-white border-2 rounded-xl p-4 transition-all",
                idx === 0 && pick.found ? "border-green-500 bg-green-50" : 
                !pick.found ? "border-orange-300 bg-orange-50" : "border-gray-200"
              )
            },
              React.createElement("div", { className: "flex items-start justify-between mb-2" },
                React.createElement("div", null,
                  React.createElement("div", { className: "font-bold text-blue-900" }, pick.player),
                  React.createElement("div", { className: "text-sm text-gray-600" }, pick.golfer),
                  !pick.found && React.createElement("div", { className: "text-xs text-orange-700 mt-1 font-semibold" }, "âš ï¸ Not found - check spelling")
                ),
                React.createElement("div", { className: "text-right" },
                  React.createElement("div", { className: "text-2xl font-bold text-blue-900" }, pick.position),
                  React.createElement("div", { className: "text-xs text-gray-500" }, "Position")
                )
              ),
              pick.found && React.createElement("div", { className: "grid grid-cols-3 gap-4 text-center pt-3 border-t" },
                React.createElement("div", null,
                  React.createElement("div", { className: "text-xs text-gray-500" }, "Score"),
                  React.createElement("div", { className: "font-semibold" }, pick.score)
                ),
                React.createElement("div", null,
                  React.createElement("div", { className: "text-xs text-gray-500" }, "Thru"),
                  React.createElement("div", { className: "font-semibold" }, pick.thru)
                ),
                React.createElement("div", null,
                  React.createElement("div", { className: "text-xs text-gray-500" }, "Earnings"),
                  React.createElement("div", { className: "font-semibold text-green-600" }, 
                    pick.earnings > 0 ? currency(pick.earnings) : "â€”"
                  )
                )
              )
            )
          )
        ),

        !isLoadingLive && liveData && matchedPicks.length === 0 && currentWeekPicks.length === 0 && 
          React.createElement("div", { className: "text-center py-8 text-gray-500" },
            React.createElement("p", null, "No picks found for this tournament")
          ),

        !isLoadingLive && liveData && React.createElement("div", { className: "bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-xs" },
          React.createElement("p", { className: "font-semibold text-blue-900 mb-1" }, "ðŸ’¡ How it works:"),
          React.createElement("p", { className: "text-blue-800 mb-2" }, 
            "Scores are scraped from ESPN.com using a CORS proxy. Auto-refreshes every 3 minutes when this tab is active."
          ),
          React.createElement("p", { className: "text-blue-800 mb-2" }, 
            `Found ${liveData.leaderboard.length} golfers in the leaderboard. `,
            `Matched ${matchedPicks.filter(p => p.found).length} of ${currentWeekPicks.length} picks.`
          ),
          React.createElement("details", { className: "mt-2" },
            React.createElement("summary", { className: "cursor-pointer font-semibold text-blue-900 hover:text-blue-700" }, "ðŸ” Debug: View Raw Data"),
            React.createElement("div", { className: "mt-2 max-h-48 overflow-y-auto bg-white p-2 rounded text-[10px] font-mono" },
              liveData.leaderboard.slice(0, 10).map((g, i) => 
                React.createElement("div", { key: i, className: "mb-1" },
                  `${g.position} | ${g.name} | Score: ${g.score} | Thru: ${g.thru}`
                )
              )
            )
          )
        )
      )
    );
  }

  function ThisWeek({ leaderName, currentWeekPicks, currentTournament }) {
    const formatDate = (dateValue) => {
      if (!dateValue) return '';
      
      let date;
      // Handle Excel date strings or Date objects
      if (typeof dateValue === 'string') {
        date = new Date(dateValue);
      } else if (dateValue instanceof Date) {
        date = dateValue;
      } else {
        return '';
      }
      
      // Check if valid date
      if (isNaN(date.getTime())) return '';
      
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', timeZone: 'UTC' });
    };

    const sortedPicks = [...currentWeekPicks].sort((a, b) => (b.Results || 0) - (a.Results || 0));

    return (
      React.createElement("section", { className: "px-4 pt-4" },
        React.createElement("div", { className: "bg-gradient-to-r from-blue-900 to-blue-800 rounded-xl p-4 text-white mb-4" },
          React.createElement("h2", { className: "text-xl font-bold mb-1" }, 
            currentTournament ? currentTournament['Tournament Name'] : 'Current Tournament'
          ),
          currentTournament && React.createElement("div", { className: "text-sm opacity-90 space-y-0.5" },
            React.createElement("p", null, 
              formatDate(currentTournament['Tournament Start Date']), " - ", 
              formatDate(currentTournament['Tournament End Date'])
            ),
            currentTournament['Tournament Purse'] && 
              React.createElement("p", null, "Purse: ", currency(currentTournament['Tournament Purse']))
          )
        ),

        leaderName && React.createElement("div", { className: "bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-4 rounded" },
          React.createElement("p", { className: "text-sm" },
            React.createElement("span", { className: "font-semibold text-yellow-900" }, "Season Leader: "),
            React.createElement("span", { className: "text-yellow-800" }, leaderName)
          )
        ),

        React.createElement("h3", { className: "font-semibold text-blue-900 mb-3" }, "This Week's Picks"),
        React.createElement("div", { className: "space-y-2 mb-16" },
          sortedPicks.length > 0 ? sortedPicks.map((pick, idx) => 
            React.createElement("div", {
              key: idx,
              className: "bg-white border border-gray-200 rounded-lg p-3 flex items-center justify-between"
            },
              React.createElement("div", null,
                React.createElement("div", { className: "font-semibold" }, pick.Player),
                React.createElement("div", { className: "text-sm text-gray-600" }, pick.Pick)
              ),
              pick.Results > 0 && React.createElement("div", { className: "text-right" },
                React.createElement("div", { className: "text-sm font-semibold text-green-600" }, currency(pick.Results))
              )
            )
          ) : React.createElement("p", { className: "text-center text-gray-500 py-8" }, "No picks recorded yet")
        )
      )
    );
  }

  function Standings({ historical, members, currentTournament }) {
    const tournaments = [...new Set(historical.map(h => h.Tournament))];
    const currentIdx = tournaments.indexOf(currentTournament?.['Tournament Name']);
    const displayTournaments = currentIdx >= 0 ? tournaments.slice(0, currentIdx + 1) : tournaments;

    const rows = useMemo(() => {
      const arr = members.map((name) => {
        const playerHistory = historical.filter(h => h.Player === name);
        const weekTotals = displayTournaments.map(t => {
          const pick = playerHistory.find(h => h.Tournament === t);
          return pick?.Results || 0;
        });
        const season = weekTotals.reduce((sum, val) => sum + val, 0);
        return { name, weekTotals, season };
      });
      arr.sort((a, b) => b.season - a.season);
      return arr.map((r, i) => ({ rank: i + 1, ...r }));
    }, [historical, members, displayTournaments]);

    return (
      React.createElement("section", { className: "px-4 pt-4" },
        React.createElement("h2", { className: "text-blue-900 font-bold text-lg mb-3" }, "Season Standings"),
        React.createElement("div", { className: "overflow-x-auto" },
          React.createElement("div", { className: "overflow-hidden rounded-xl border inline-block min-w-full" },
            React.createElement("table", { className: "text-sm" },
              React.createElement("thead", { className: "bg-blue-900 text-white" },
                React.createElement("tr", null,
                  React.createElement("th", { className: "text-left px-3 py-2 sticky left-0 bg-blue-900 z-10" }, "Rank"),
                  React.createElement("th", { className: "text-left px-3 py-2 sticky left-12 bg-blue-900 z-10" }, "Player"),
                  displayTournaments.map((t, i) =>
                    React.createElement("th", { key: i, className: "text-right px-3 py-2 whitespace-nowrap text-xs" }, 
                      `W${i + 1}`
                    )
                  ),
                  React.createElement("th", { className: "text-right px-3 py-2 font-bold bg-blue-900 sticky right-0" }, "Season")
                )
              ),
              React.createElement("tbody", null,
                rows.map((r) =>
                  React.createElement("tr", { key: r.rank, className: "odd:bg-white even:bg-gray-50" },
                    React.createElement("td", { className: "px-3 py-2 font-semibold text-blue-900 sticky left-0 bg-inherit z-10" }, r.rank),
                    React.createElement("td", { className: "px-3 py-2 sticky left-12 bg-inherit z-10" }, r.name),
                    r.weekTotals.map((wk, i) =>
                      React.createElement("td", { key: i, className: "px-3 py-2 text-right text-xs" }, 
                        wk > 0 ? currency(wk) : "â€”"
                      )
                    ),
                    React.createElement("td", { className: "px-3 py-2 text-right font-semibold bg-inherit sticky right-0" }, 
                      r.season > 0 ? currency(r.season) : "$0"
                    )
                  )
                )
              )
            )
          )
        ),
        React.createElement("p", { className: "text-xs text-gray-600 mt-3 mb-16" }, 
          `Showing all ${displayTournaments.length} tournament${displayTournaments.length !== 1 ? 's' : ''} this season.`
        )
      )
    );
  }

  function History({ historical }) {
    const tournaments = [...new Set(historical.map(h => h.Tournament))];
    const players = [...new Set(historical.map(h => h.Player))].sort();
    
    const [selectedTournament, setSelectedTournament] = useState('');
    const [selectedPlayer, setSelectedPlayer] = useState('');
    
    const filteredRows = useMemo(() => {
      let filtered = historical;
      
      if (selectedTournament) {
        filtered = filtered.filter(h => h.Tournament === selectedTournament);
      }
      
      if (selectedPlayer) {
        filtered = filtered.filter(h => h.Player === selectedPlayer);
      }
      
      return filtered;
    }, [historical, selectedTournament, selectedPlayer]);

    return (
      React.createElement("section", { className: "px-4 pt-4" },
        React.createElement("h2", { className: "text-blue-900 font-bold text-lg mb-3" }, "Pick History"),
        
        React.createElement("div", { className: "space-y-2 mb-3" },
          React.createElement("div", null,
            React.createElement("label", { className: "block text-sm text-gray-700 mb-1" }, "Filter by player:"),
            React.createElement("select", {
              value: selectedPlayer,
              onChange: (e) => setSelectedPlayer(e.target.value),
              className: "w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
            },
              React.createElement("option", { value: "" }, "All Players"),
              players.map(p => React.createElement("option", { key: p, value: p }, p))
            )
          ),
          React.createElement("div", null,
            React.createElement("label", { className: "block text-sm text-gray-700 mb-1" }, "Filter by tournament:"),
            React.createElement("select", {
              value: selectedTournament,
              onChange: (e) => setSelectedTournament(e.target.value),
              className: "w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
            },
              React.createElement("option", { value: "" }, "All Tournaments"),
              tournaments.map(t => React.createElement("option", { key: t, value: t }, t))
            )
          )
        ),

        React.createElement("div", { className: "overflow-hidden rounded-xl border" },
          React.createElement("table", { className: "w-full text-sm" },
            React.createElement("thead", { className: "bg-blue-900 text-white" },
              React.createElement("tr", null,
                React.createElement("th", { className: "text-left px-3 py-2" }, "Player"),
                React.createElement("th", { className: "text-left px-3 py-2" }, "Golfer"),
                React.createElement("th", { className: "text-right px-3 py-2" }, "Earnings")
              )
            ),
            React.createElement("tbody", null,
              filteredRows.length > 0 ? filteredRows.map((p, idx) =>
                React.createElement("tr", { key: idx, className: "odd:bg-white even:bg-gray-50" },
                  React.createElement("td", { className: "px-3 py-2" }, p.Player),
                  React.createElement("td", { className: "px-3 py-2" }, p.Pick),
                  React.createElement("td", { className: "px-3 py-2 text-right" }, 
                    p.Results > 0 ? currency(p.Results) : "$0"
                  )
                )
              ) : React.createElement("tr", null,
                React.createElement("td", { colSpan: 3, className: "px-3 py-6 text-center text-gray-500" }, "No history found")
              )
            )
          )
        ),
        React.createElement("p", { className: "text-xs text-gray-600 mt-3 mb-16" }, 
          `Showing ${filteredRows.length} pick${filteredRows.length !== 1 ? 's' : ''}` +
          `${selectedPlayer ? ' for ' + selectedPlayer : ''}` +
          `${selectedTournament ? ' at ' + selectedTournament : ''}`
        )
      )
    );
  }

  function PicksUsed({ picksUsedByPlayer, members }) {
    const [selectedPlayer, setSelectedPlayer] = useState('all');
    
    // Get all unique golfers used across all players
    const allGolfersUsed = useMemo(() => {
      const golfers = new Set();
      Object.values(picksUsedByPlayer).forEach(picks => {
        picks.forEach(pick => golfers.add(pick));
      });
      return Array.from(golfers).sort();
    }, [picksUsedByPlayer]);

    const displayData = useMemo(() => {
      if (selectedPlayer === 'all') {
        // Show all players and their picks
        return members.map(player => ({
          player,
          picks: picksUsedByPlayer[player] || [],
          count: (picksUsedByPlayer[player] || []).length
        }));
      } else {
        // Show just the selected player
        return [{
          player: selectedPlayer,
          picks: picksUsedByPlayer[selectedPlayer] || [],
          count: (picksUsedByPlayer[selectedPlayer] || []).length
        }];
      }
    }, [selectedPlayer, picksUsedByPlayer, members]);

    return (
      React.createElement("section", { className: "px-4 pt-4" },
        React.createElement("h2", { className: "text-blue-900 font-bold text-lg mb-1" }, "Picks Used"),
        React.createElement("p", { className: "text-sm text-gray-600 mb-3" }, 
          "Track which golfers each player has used this season"
        ),
        
        React.createElement("div", { className: "mb-3" },
          React.createElement("label", { className: "block text-sm text-gray-700 mb-1" }, "Filter by player:"),
          React.createElement("select", {
            value: selectedPlayer,
            onChange: (e) => setSelectedPlayer(e.target.value),
            className: "w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
          },
            React.createElement("option", { value: "all" }, "All Players"),
            members.map(m => React.createElement("option", { key: m, value: m }, m))
          )
        ),

        React.createElement("div", { className: "space-y-3 mb-16" },
          displayData.map(data => 
            React.createElement("div", {
              key: data.player,
              className: "bg-white border border-gray-200 rounded-lg p-4"
            },
              React.createElement("div", { className: "flex items-center justify-between mb-3 pb-2 border-b" },
                React.createElement("h3", { className: "font-bold text-blue-900" }, data.player),
                React.createElement("span", { className: "text-sm text-gray-600" }, 
                  `${data.count} golfer${data.count !== 1 ? 's' : ''} used`
                )
              ),
              data.picks.length > 0 ? React.createElement("div", { className: "flex flex-wrap gap-2" },
                data.picks.map(pick => 
                  React.createElement("span", {
                    key: pick,
                    className: "inline-block bg-blue-50 text-blue-900 px-3 py-1 rounded-full text-sm"
                  }, pick)
                )
              ) : React.createElement("p", { className: "text-sm text-gray-500 italic" }, "No picks yet")
            )
          )
        ),

        selectedPlayer === 'all' && React.createElement("div", { className: "bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-xs" },
          React.createElement("p", { className: "font-semibold text-blue-900 mb-1" }, "ðŸ“Š Season Stats:"),
          React.createElement("p", { className: "text-blue-800" }, 
            `Total unique golfers used: ${allGolfersUsed.length}`
          )
        )
      )
    );
  }

  ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>
</body>
</html>
